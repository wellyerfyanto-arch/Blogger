{% extends "base.html" %}

{% block title %}Settings - Auto Posting Blog{% endblock %}

{% block content %}
<div class="settings-container">
    <h2>⚙️ API Settings</h2>
    
    <div class="settings-card">
        <form id="apiSettingsForm">
            <div class="form-group">
                <label for="openai_api_key">OpenAI API Key:</label>
                <input type="text" id="openai_api_key" value="{{ keys.openai_api_key }}" placeholder="sk-...">
                <small>Required for content generation</small>
            </div>
            
            <div class="form-group">
                <label for="hf_api_key">Hugging Face API Key:</label>
                <input type="text" id="hf_api_key" value="{{ keys.hf_api_key }}" placeholder="hf_...">
                <small>Required for image generation</small>
            </div>
            
            <div class="form-group">
                <label for="blogger_blog_id">Blogger Blog ID:</label>
                <input type="text" id="blogger_blog_id" value="{{ keys.blogger_blog_id }}" placeholder="1234567890123456789">
                <small>Your Blogger blog ID</small>
            </div>
            
            <div class="form-group">
                <label for="google_client_id">Google Client ID:</label>
                <input type="text" id="google_client_id" value="{{ keys.google_client_id }}" placeholder="xxx.apps.googleusercontent.com">
                <small>Google OAuth client ID</small>
            </div>
            
            <div class="form-group">
                <label for="google_client_secret">Google Client Secret:</label>
                <input type="text" id="google_client_secret" value="{{ keys.google_client_secret }}" placeholder="GOCSPX-...">
                <small>Google OAuth client secret</small>
            </div>
            
            <button type="submit" class="btn-primary">Save Settings</button>
            <button type="button" id="testSettingsBtn" class="btn-secondary">Test Connections</button>
        </form>
    </div>
    
    <div id="testResults" class="test-results" style="display: none;"></div>
</div>

<script>
document.getElementById('apiSettingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = {
        openai_api_key: document.getElementById('openai_api_key').value,
        hf_api_key: document.getElementById('hf_api_key').value,
        blogger_blog_id: document.getElementById('blogger_blog_id').value,
        google_client_id: document.getElementById('google_client_id').value,
        google_client_secret: document.getElementById('google_client_secret').value
    };
    
    fetch('/api/settings/keys', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            alert('Settings saved successfully!');
        }
    })
    .catch(error => {
        alert('Error saving settings: ' + error);
    });
});

document.getElementById('testSettingsBtn').addEventListener('click', function() {
    const formData = {
        openai_api_key: document.getElementById('openai_api_key').value,
        hf_api_key: document.getElementById('hf_api_key').value
    };
    
    fetch('/api/settings/test', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        const resultsDiv = document.getElementById('testResults');
        resultsDiv.style.display = 'block';
        
        let html = '<h3>Test Results:</h3>';
        
        if (data.results) {
            for (const [service, result] of Object.entries(data.results)) {
                html += `
                    <div class="test-result ${result.status}">
                        <strong>${service.toUpperCase()}:</strong> 
                        ${result.status === 'success' ? '✅' : '❌'} 
                        ${result.message}
                    </div>
                `;
            }
        } else if (data.error) {
            html += `<div class="test-result error">Error: ${data.error}</div>`;
        }
        
        resultsDiv.innerHTML = html;
    })
    .catch(error => {
        const resultsDiv = document.getElementById('testResults');
        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = `<div class="test-result error">Test failed: ${error}</div>`;
    });
});
</script>
{% endblock %}
